<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8">

    <title>ALOM - CI/CD</title>

    <meta name="description" content="ALOM - CI/CD">
    <meta name="author" content="Julien WITTOUCK <julien@codeka.io>">

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="../css/reveal.css">
    <link rel="stylesheet" href="../css/theme/white.css" id="theme">

    <link rel="stylesheet" href="../css/miage-lille.css"/>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
          integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
</head>

<body>

<div class="reveal">

    <div class="slides">
        <section>
            <h1>ALOM</h1>
            <h2>‚öôÔ∏è CI/CD</h2>
        </section>

        <section>
            <h2>Probl√©matiques</h2>
            <ul>
                <li>üîÄ Comment int√©grer le code des d√©veloppeurs rapidement ?</li>
                <li>‚úÖ Valider la non-r√©gression d'une application ?</li>
                <li>üìä Suivre l'√©volution de la qualit√© du code ?</li>
                <li>üöÄ D√©ployer automatiquement sur diff√©rents environnements ?</li>
            </ul>
        </section>

        <section>
            <h2>Continuous Integration (CI)</h2>
            <ul>
                <li>int√©gration rapide du code des d√©veloppeurs</li>
                <li>ex√©cution des tests unitaires</li>
                <li>validation de la non r√©gression du code</li>
                <li>suivi de l'√©volution de la qualit√© du code</li>
            </ul>
        </section>

        <section>
            <h2>Continuous Deployment (or Continuous Delivery) (CD)</h2>
            <ul>
                <li>production d'un livrable pour l'application</li>
                <li>mise √† disposition sur un repository de binaire</li>
                <li>d√©ploiement automatis√©</li>
                <li>mont√©e d'environnement en environnement</li>
            </ul>
        </section>

        <section>
            <h2>Vision globale</h2>
            <h3>CI + CD</h3>
            <img src="ci-cd.png"/>
        </section>

        <section>
            <h2>Notions communes aux plateformes</h2>
            <ul>
                <li>Pipeline / Workflow : constitue l'ensemble des √©tapes d'une int√©gration continue</li>
                <li>Job : Une √©tape d'une int√©gration continue (ex: build, tests...)</li>
                <li>Artefact: Un objet produit par un job (code compil√©, package). Pourra √™tre t√©l√©charg√© ou pass√© en param√®tre √† un autre job.</li>
                <li>Les pipelines / workflow sont ex√©cut√©s sur toutes les branches du code</li>
            </ul>
        </section>

        <section>
            <h2>Branches & CI</h2>
            <img src="ci-cd-branches.png"/>
        </section>

        <section>
            <h2>üí°</h2>
            <p>Le pipeline doit √™tre adapt√© en fonction des pratiques de l'√©quipe de DEV</p>
            <p>Chaque √©quipe a son mod√®le de gestion de branches (git flow, trunk based development...)</p>
            <p>Chaque √©quipe a une maturit√© diff√©rente sur le d√©ploiement (manuel, automatique en dev, continu en prod...)</p>
        </section>

        <section>
            <h2>Les outils</h2>
            <ul>
                <li>
                    Proches du code
                    <ul>
                        <li>Gitlab CI</li>
                        <li>Github Actions</li>
                    </ul>
                </li>
                <li>
                    Externalis√©s
                    <ul>
                        <li>Jenkins</li>
                        <li>travis-ci</li>
                        <li>CircleCI</li>
                    </ul>
                </li>
            </ul>
        </section>

        <section>
            <h1>Gitlab CI</h1>
        </section>

        <section>
            <h2>Gitlab-CI</h2>
            <p>Gitlab CI est le produit d'int√©gration continue int√©gr√© √† Gitlab.</p>
            <p>Les pipelines sont d√©crits dans un fichier <code>.gitlab-ci.yml</code></p>
            <p>Les pipelines sont d√©clench√©s par un <i>push</i>, <i>tag</i>, appel d'API, manuellement, ou programm√©s (cron)</p>
        </section>

        <section>
            <h2>Gitlab CI - Vocabulaire</h2>
            <ul>
                <li>Le <i>pipeline</i> constitue l'ensemble des √©tapes d'une int√©gration continue.</li>
                <li>Un <i>pipeline</i> est d√©coup√© en <i>stage</i>s successifs (ex: build, test, deploy).</li>
                <li>Un <i>stage</i> contient un ou plusieurs <i>job</i>s.</li>
                <li>Un <i>job</i> est une action unitaire (ex: compilation, ex√©cution des tests...), et contient un script shell.</li>
                <li>Les <i>job</i>s d'un m√™me stage sont ex√©cut√©s en parall√®le.</li>
                <li>Les <i>job</i> peuvent se passer des <i>artefact</i>s (ex: un jar compil√©).</li>
            </ul>
        </section>

        <section>
            <h2>Gitlab CI</h2>
            <img src="gitlab-ci-pipeline.png"/>
        </section>

        <section>
            <h2>Gitlab CI - Techniquement</h2>
            <ul>
                <li>Le Gitlab Runner est un composant en charge de l'ex√©cution des jobs.</li>
                <li>Les jobs sont ex√©cut√©s dans des containers <i>docker</i>.</li>
                <li>Le repository de code est clon√© dans le container avant l'ex√©cution du job.</li>
                <li>Des variables d'environnement sont inject√©es dans le container du job.</li>
            </ul>
        </section>

        <section>
            <h2>Anatomie d'un job Gitlab CI</h2>
            <img src="gitlab-ci-job.png"/>
        </section>

        <section>
            <h2>Anatomie d'un pipeline</h2>
            <div style="display: flex; flex-direction: row;">
                <img src="gitlab-ci-pipeline-1.png" style="width: 50%;"/>
                <img src="gitlab-ci-pipeline-2.png" style="width: 50%;"/>
            </div>
        </section>

        <section>
            <h2>Configuration avec les variables d'environnement</h2>
            <img src="gitlab-ci-variables.png"/>
        </section>

        <section>
            <h2>Liens utiles</h2>
            <a target="_blank" href="https://docs.gitlab.com/ee/ci/yaml/">La r√©f√©rence pour le fichier .gitlab-ci.yml</a>
            <a target="_blank" href="https://docs.gitlab.com/ee/ci/examples/#cicd-templates">Des templates pour tous les langages</a>
            <a target="_blank" href="https://docs.gitlab.com/ee/ci/variables/predefined_variables.html">Les variables pr√©d√©finies</a>
        </section>

        <section>
            <h1>Github Actions</h1>
        </section>

        <section>
            <h2>Github Actions</h2>
            <p>Github Actions est le produit d'int√©gration continue int√©gr√© √† Github.</p>
            <p>Les <i>workflow</i>s sont d√©crits dans des fichiers yml d√©pos√©s dans le r√©pertoire <code>.github/workflows</code>.</p>
            <p>Les workflow sont d√©clench√©s par des <i>event</i>.</p>
            <p>
                un <i>event</i> peut √™tre un <i>push</i>, <i>tag</i>, appel d'API,
                d√©clenchement manuel, ou programm√©s (cron),
                mais aussi, une nouvelle issue, un nouveau label sur une issue/pr, un commentaire dans une issue...
            </p>
        </section>

        <section>
            <h2>Github Actions - Vocabulaire</h2>
            <ul>
                <li>Le <i>workflow</i> constitue l'ensemble des √©tapes d'une int√©gration continue.</li>
                <li>Un <i>workflow</i> est d√©coup√© en <i>job</i>s.</li>
                <li>Un <i>job</i> est une suite de <i>step</i>s unitaire (ex: compilation, ex√©cution des tests...).</li>
                <li>Une <i>step</i> est soit un script shell, soit une <i>action</i>.</li>
                <li>Une <i>action</i> est un bloc d'int√©gration continu r√©utilisable.</li>
                <lI>Une marketplace permet de lister/publier des actions.</lI>
                <li>Les <i>job</i>s d'un m√™me <i>workflow</i> sont ex√©cut√©s en parall√®le.</li>
            </ul>
        </section>

        <section>
            <h2>Github Actions - Les actions</h2>
            <p>Une action est un √©l√©ment de workflow r√©utilisable</p>
            <ul>
                Ex:
                <li>R√©cup√©ration du code d'un repository</li>
                <li>Installation d'un langage/runtime</li>
                <li>Ex√©cuter une compilation</li>
                <li>Sauvegarder/T√©l√©charger un artefact</li>
                <li>Envoyer une notification Slack / Discord</li>
            </ul>
        </section>

        <section>
            <h2>Github Actions - Techniquement</h2>
            <ul>
                <li>Le Runner est un composant en charge de l'ex√©cution des jobs.</li>
                <li>Les jobs sont ex√©cut√©s dans un environnement <i>virtualis√©</i> (une VM).</li>
                <li>
                    Les VM de runner contiennent un ensemble de librairies pr√©-install√©es, langages et outils.
                    <a href="https://github.com/actions/virtual-environments/blob/ubuntu20/20211108.1/images/linux/Ubuntu2004-README.md" target="_blank">La liste pour ubuntu 20.04</a>.
                </li>
                <li>Le repository de code n'est pas clon√© avant l'ex√©cution du job (il faut le faire avec une action).</li>
                </ul>
        </section>
        <section>
            <h2>Github Actions - Variables &amp; Secrets</h2>
            <ul>
                <li>Des variables d'environnement sont inject√©es dans la VM du workflow.</li>
                <li>Des <i>secret</i>s peuvent √™tre configur√©s pour passer des param√®tres (cl√©s d'API...)</li>
                <li>Un <i>secret</i> <code>GITHUB_TOKEN</code> pour acc√©der √† l'API Github est fourni par d√©faut.</li>
            </ul>
        </section>

        <section>
            <h2>Anatomie d'un job Github Actions</h2>
            <img src="github-actions-job.png"/>
        </section>

        <section>
            <h2>Une <i>step</i></h2>
            <ul></ul>
            <ul>
                <li><code>uses</code> pour importer une action existante</li>
                <li><code>with</code> pour lui passer des param√®tres</li>
                <li><code>run</code> pour ex√©cution un script shell</li>
            </ul>
        </section>

        <section>
            <h2>Anatomie d'un workflow</h2>
            <img src="github-actions-workflow.png" style="width: 40%;"/>
        </section>

        <section>
            <h2>Liens utiles</h2>
            <a target="_blank" href="https://github.com/marketplace?type=actions">La marketplace</a>
            <a target="_blank" href="https://docs.github.com/en/actions/learn-github-actions/events-that-trigger-workflows">Les event qui peuvent lancer un workflow</a>
            <a target="_blank" href="https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions">La syntaxe compl√®te</a>
        </section>

        <section>
            <h2>TP</h2>
            <img src="../images/leonidas.png"/>
            <p>
                <a href="11-tp-ci-cd.html">CI/CD</a>
            </p>
        </section>

    </div>

</div>

<script src="../js/reveal.js"></script>

<script>
    Reveal.initialize({
        controls: true,
        controlsBackArrows: 'faded',
        progress: true,
        history: true,
        center: true,
        transition: 'slide'
    });

</script>

<aside class="miage_aside_logo"></aside>

</body>
</html>
